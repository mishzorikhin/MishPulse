üß≠ –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

MishPulse ‚Äî —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É ¬´–ø—É–ª—å—Å–∞¬ª (heartbeat).

üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å self-hosted —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π:

–ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (¬´—è –∂–∏–≤¬ª –∏–ª–∏ ¬´–æ—à–∏–±–∫–∞¬ª).

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ¬´–º–æ–ª—á–∞—Ç¬ª –¥–æ–ª—å—à–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

–£–≤–µ–¥–æ–º–ª—è–µ—Ç (—á–µ—Ä–µ–∑ Telegram / Email / Webhook) –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–ª–∏ –æ—à–∏–±–∫–∞—Ö.

‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

Collector API (FastAPI)
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç monitored-—Å–µ—Ä–≤–∏—Å–æ–≤.
–ö–∞–∂–¥–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π token –∏–ª–∏ id.

Scheduler / Watchdog
–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–∫–∞–∂–¥—ã–µ X —Å–µ–∫—É–Ω–¥) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ ¬´–ø—É–ª—å—Å–∞¬ª.
–ï—Å–ª–∏ –∑–∞–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–µ timeout, —Å—á–∏—Ç–∞–µ—Ç —Å–µ—Ä–≤–∏—Å ¬´–ø–æ–≥–∏–±—à–∏–º¬ª.

Notifier
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Telegram / Email / Webhook) –ø—Ä–∏:

–ü–æ—Ç–µ—Ä–µ –ø—É–ª—å—Å–∞

–°–æ–æ–±—â–µ–Ω–∏–∏ –æ–± –æ—à–∏–±–∫–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

Web UI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–µ—Ä–≤–∏—Å–æ–≤:

üü¢ –∂–∏–≤

üü† –æ—à–∏–±–∫–∞

üî¥ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

–•—Ä–∞–Ω–∏–ª–∏—â–µ
–ü—Ä–æ—Å—Ç–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite, Postgres –∏–ª–∏ Redis).
–¢–∞–±–ª–∏—Ü–∞ heartbeats:

id | service_name | last_seen | status | message

üß© API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
POST /api/heartbeat/<token>

–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞:

{
  "status": "ok",       // ok | warning | error
  "message": "optional human-readable text"
}


–û—Ç–≤–µ—Ç:

{"result": "ok"}


–ü—Ä–∏ status="ok" –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è last_seen –∏ status="alive".

–ü—Ä–∏ status="error" ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è last_seen, status="error", —Å–æ–∑–¥–∞—ë—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω ‚Äî 403.

GET /api/status

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

[
  {"name": "service-a", "status": "alive", "last_seen": "2025-10-16T12:00:00Z"},
  {"name": "service-b", "status": "dead", "last_seen": "2025-10-16T11:40:00Z"}
]

üß† –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ (Watchdog)

–ö–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥:

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –≤—ã—á–∏—Å–ª–∏—Ç—å now - last_seen.

–ï—Å–ª–∏ > timeout (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 –º–∏–Ω—É—Ç) ‚Üí status = "dead", —É–≤–µ–¥–æ–º–∏—Ç—å.

–ï—Å–ª–∏ status="error" ‚Üí —É–≤–µ–¥–æ–º–∏—Ç—å, –Ω–æ –Ω–µ —Å—á–∏—Ç–∞—Ç—å –º—ë—Ä—Ç–≤—ã–º.

üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

Telegram Bot (—á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω –∏ chat_id).

Email (—á–µ—Ä–µ–∑ SMTP).

Webhook (POST —Å JSON).

–ü—Ä–∏–º–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

‚ùå Service api-worker –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç.
–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª: 12:03 UTC

üêç –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

Backend: Python 3.11+, FastAPI

Scheduler: APScheduler –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π asyncio task

DB: SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –≤–æ–∑–º–æ–∂–Ω–æ Redis

Notif: aiogram / aiosmtplib / requests

Deploy: Docker / systemd

üöÄ –ü—Ä–∏–º–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞
import requests, time

TOKEN = "abc123"
URL = "https://monitor.yourdomain/api/heartbeat/" + TOKEN

while True:
    try:
        # some app logic
        requests.post(URL, json={"status": "ok"})
    except Exception as e:
        requests.post(URL, json={"status": "error", "message": str(e)})
    time.sleep(60)
